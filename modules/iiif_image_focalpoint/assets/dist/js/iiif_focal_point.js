!function(){"use strict";!function(){const i={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,i)}catch(i){}globalThis.process={env:i}}(),function(i,t){let o=[];t.behaviors.iiifFocalPointIndicator={attach:function(n){once("iiif-focal-point-hide-field",".focal-point",n).forEach((function(t){var o=i(t).closest(".iiif-focal-point-wrapper");i(t).hasClass("error")||(o.addClass("visually-hidden"),i(t).on("focus",(function(){o.removeClass("visually-hidden")})).on("blur",(function(){o.addClass("visually-hidden")})))})),once("iiif-focal-point-hide-field",".iiif-focal-point-indicator",n).forEach((function(n){var a=i(n),c=i(n).siblings("img"),e=i(n).siblings(".iiif-focal-point-preview-link"),s=i("."+i(n).attr("data-selector")),r=new t.IiifFocalPoint(a,c,s,e);o.push(r),setTimeout((function(){c.one("load",(function(){r.setIndicator()})).each((function(){this.complete&&i(this).trigger("load")}))}),0)}))}},t.IiifFocalPoint=function(t,o,n,a){var c=this;this.$indicator=t,this.$img=o,this.$field=n,this.$previewLink=a,this.$indicator.draggable({containment:c.$img,stop:function(){var i=c.$img.offset(),t=c.$indicator.offset(),o=t.left-i.left,n=t.top-i.top;c.set(o,n)}}),this.$indicator.on("dblclick",(function(){c.$field.closest(".iiif-focal-point-wrapper").toggleClass("visually-hidden")})),this.$img.on("click",(function(i){c.set(i.offsetX,i.offsetY)})),this.$img.css("cursor","crosshair"),this.$field.on("change",(function(){i(document).trigger("drupalIiifFocalPointSet",{$iiifFocalPoint:c})})),this.$indicator.add(this.$img).add(this.$previewLink).wrapAll("<div class='iiif-focal-point-wrapper' />")},t.IiifFocalPoint.prototype.set=function(t,o){var n=this.calculate(t,o);this.$field.val(n.x+","+n.y).trigger("change"),i(document).trigger("drupalIiifFocalPointSet",{$iiifFocalPoint:this})},t.IiifFocalPoint.prototype.setIndicator=function(){var i=""!==this.$field.val()&&void 0!==this.$field.val()?this.$field.val().split(","):[50,50],t=Math.min(this.$img.width(),parseInt(i[0],10)/100*this.$img.width()),o=Math.min(this.$img.height(),parseInt(i[1],10)/100*this.$img.height());this.$indicator.css("left",Math.max(0,t)),this.$indicator.css("top",Math.max(0,o)),this.$field.val(i[0]+","+i[1])},t.IiifFocalPoint.prototype.calculate=function(i,t){var o={};return o.x=this.round(100*i/this.$img.width(),0,100),o.y=this.round(100*t/this.$img.height(),0,100),o},t.IiifFocalPoint.prototype.round=function(i,t,o){var n=Math.max(Math.round(i),t);return n=Math.min(n,o)},i(document).on("drupalIiifFocalPointSet",(function(i,t){t.$iiifFocalPoint.setIndicator()})),i(window).on("resize",(function(t,n){o.forEach((t=>{i(document).trigger("drupalIiifFocalPointSet",{$iiifFocalPoint:t})}))})),i(window).on("click",(function(t,n){o.forEach((t=>{i(document).trigger("drupalIiifFocalPointSet",{$iiifFocalPoint:t})}))}))}(jQuery,Drupal)}();