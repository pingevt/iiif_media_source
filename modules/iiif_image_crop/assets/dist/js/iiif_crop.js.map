{"version":3,"file":"iiif_crop.js","sources":["../../src/js/iiif_crop.js"],"sourcesContent":["/**\n * @file\n * Javascript functionality for the IIIF Crop widget.\n */\n\n(function ($, Drupal) {\n  'use strict';\n\n  /**\n   * Focal Point indicator.\n   */\n  Drupal.behaviors.iiifCrop = {\n    attach: function (context) {\n\n      once('iiif-crop-hide-field', '.crop', context).forEach(function (el) {\n        // console.log(el);\n        var $wrapper = $(el).closest('.crop-wrapper');\n        // Add the \"visually-hidden\" class unless the focal point offset field\n        // has an error. This will show the field for everyone when there is an\n        // error and for non-sighted users no matter what. We add it the\n        // form item to make sure the field is focusable while\n        // the entire form item is hidden for sighted users.\n        if (!$(el).hasClass('error')) {\n          $wrapper.addClass('visually-hidden');\n          $(el).on('focus', function () {\n            $wrapper.removeClass('visually-hidden');\n          }).on('blur', function () {\n            $wrapper.addClass('visually-hidden');\n          });\n        }\n      });\n\n      once('iiif-crop-cropper', '.field--widget-iiif-image-crop-widget .cropper-image > img.iiif-crop-img:not(.cropper-hidden), .field--widget-iiif-image-widget .cropper-image > img.iiif-crop-img:not(.cropper-hidden)', context).forEach(element => {\n        console.log(\"h\", element);\n        let cropWrapperInput = element.closest(\".field--type-iiif-id\").querySelector('.crop-wrapper input');\n\n        let initialized = false;\n\n        const cropper = new Cropper(element, {\n          viewMode: 2,\n          scalable: false,\n          rotatable: true,\n          dragMode: 'move',\n          zoomable: false,\n          // aspectRatio: 16 / 9,\n          // data: {},\n          ready() {\n\n            let initData = cropWrapperInput.value.split(\",\");\n            let initImgData = this.cropper.getImageData();\n\n            let intCrop = {\n              x: initData[0] / 100 * initImgData.naturalWidth,\n              y: initData[1] / 100 * initImgData.naturalHeight,\n              width: initData[2] / 100 * initImgData.naturalWidth,\n              height: initData[3] / 100 * initImgData.naturalHeight,\n            };\n\n            this.cropper.setData(intCrop);\n\n            initialized = true;\n          },\n          crop(event) {\n            if (initialized) {\n\n              let initImgData = this.cropper.getImageData();\n              let x = (event.detail.x / initImgData.naturalWidth) * 100;\n              let y = (event.detail.y / initImgData.naturalHeight) * 100;\n              let w = (event.detail.width / initImgData.naturalWidth) * 100;\n              let h = (event.detail.height / initImgData.naturalHeight) * 100;\n\n              let d = [\n                x.toFixed(2),\n                y.toFixed(2),\n                w.toFixed(2),\n                h.toFixed(2),\n              ];\n\n              cropWrapperInput.value = d.join(\",\");\n            }\n          },\n        });\n      });\n    }\n  };\n})(jQuery, Drupal);\n"],"names":[],"mappings":"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"}